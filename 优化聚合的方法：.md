优化聚合的方法：

1. 如果要聚合多个字段，可以在doc中提前把这个字段存入，提高聚合效率
2. 减少返回桶的数量，能够显著减少响应时间。但返回的桶数量少了，对结果的准确性会有影响
3. 设置size=0将可以使用缓存，在这种情况下重复的查询条件可以利用缓存，提高响应速度。但如果请求中有一些时间相关的条件，则没法使用缓存
4. 启用 eager global ordinals 提升高基数聚合性能；在刷新（refresh）分片时构建全局序号。这将构建全局序号的成本从搜索阶段转移到了数据索引化（写入）阶段；会影响写入性能 ；以空间换时间
5. 如果一个查询中进行多个聚合，是串行进行的，可以使用msearch一次提交多个聚合，加快响应